<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro | Empresa</title>
    <link rel="stylesheet" href="../css/register.css"> <!-- Corrigido caminho -->
</head>

<body>
    <header>
        <div class="logo">
            <img src="../public/images/logo.png" alt="Logo da Empresa"> <!-- Corrigido caminho -->
            <h1></h1>
        </div>
    </header>

    <div class="container">
        <div class="register-card">
            <h2>Crie sua conta</h2>
            <!-- Formulário sem action/method pois será tratado por JavaScript -->
            <form id="registerForm">
                <div class="input-group">
                    <label for="name">Nome Completo</label>
                    <input type="text" id="name" name="name" placeholder="Digite seu nome completo" required>
                </div>
                <div class="input-group">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" name="email" placeholder="Digite seu e-mail" required>
                </div>
                <div class="input-group">
                    <label for="cpf">CPF</label>
                    <input type="text" id="cpf" name="cpf" placeholder="Digite seu CPF" required maxlength="14">
                </div>
                <div class="input-group">
                    <label for="phone">Telefone</label>
                    <input type="tel" id="phone" name="phone" placeholder="Digite seu telefone" required>
                </div>
                <div class="input-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" name="password" placeholder="Crie uma senha" required>
                </div>
                <div class="input-group">
                    <label for="confirmPassword">Confirme sua Senha</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Repita sua senha"
                        required>
                </div>
                <div class="terms">
                    <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                    <label for="agreeTerms">Eu concordo com os <a href="#">Termos de Serviço</a> e <a href="#">Política
                            de Privacidade</a></label>
                </div>
                <button type="submit" class="register-button">Cadastrar</button>
            </form>
            <div class="login-link">
                Já tem uma conta? <a href="login.html">Faça login</a>
            </div>
        </div>
    </div>

    <!-- Script incorporado diretamente (não mais como módulo) -->
    <script>
        // Constante com a URL da API
        const API_URL = 'http://127.0.0.1:8080/api/usuarios'; // endpoint base

   
        // Função para cadastrar usuário
        async function cadastrarUsuario(dados) {
            const res = await fetch(`${API_URL}/registrar`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            });

            if (!res.ok) {
                let errorMessage = 'Erro na requisição';
                try {
                    const err = await res.json();
                    errorMessage = err.message || errorMessage;
                } catch {
                    // resposta não é JSON, ignora
                }
                throw new Error(errorMessage);
            }

            return res.json();
        }

        // Event listener para o formulário
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;

            // Obter dados do formulário
            const data = {
                nome: form.name.value,
                email: form.email.value,
                cpf: form.cpf.value.replace(/\D/g, ''),
                telefone: form.phone.value.replace(/\D/g, ''),
                senha: form.password.value,
                confirmarSenha: form.confirmPassword.value,
                agreeTerms: form.agreeTerms.checked
            };

            // Validação básica - senhas coincidem
            if (data.senha !== data.confirmarSenha) {
                alert('As senhas não coincidem!');
                return;
            }

            // Validação - termos aceitos (já garantido pelo required no HTML)
            if (!document.getElementById('agreeTerms').checked) {
                alert('Você deve aceitar os termos de serviço!');
                return;
            }

            try {
                // Chamada à API
                const response = await cadastrarUsuario(data);
                console.log('Usuário cadastrado com sucesso:', response);
                alert('Cadastro realizado com sucesso!');

                // Redirecionar para login após cadastro bem-sucedido
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Erro ao cadastrar usuário:', error);
                alert('Erro ao cadastrar: ' + error.message);
            }
        });

        // Máscara para CPF (opcional)
        document.getElementById('cpf').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');

            if (value.length > 3) value = value.replace(/^(\d{3})/, '$1.');
            if (value.length > 7) value = value.replace(/^(\d{3})\.(\d{3})/, '$1.$2.');
            if (value.length > 11) value = value.replace(/^(\d{3})\.(\d{3})\.(\d{3})/, '$1.$2.$3-');

            e.target.value = value.substring(0, 14);
        });

        // Máscara para telefone (opcional)
        document.getElementById('phone').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            let formattedValue = '';

            if (value.length > 0) {
                formattedValue = '(' + value.substring(0, 2);
            }
            if (value.length > 2) {
                formattedValue += ') ' + value.substring(2, 7);
            }
            if (value.length > 7) {
                formattedValue += '-' + value.substring(7, 11);
            }

            e.target.value = formattedValue;
        });
    </script>
</body>

</html>